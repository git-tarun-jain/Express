<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Product</title>
  <link rel="stylesheet" href="/cart.css" />
</head>

<body>
 
<div class="cart-container">
  <h2>Shopping Cart</h2>
  <div class="cart-items">
      <% Object.values(cartItemData).forEach(cartItem => { %>
        <div class="cart-item">
          <img src="<%= cartItem.image %>" alt="Product Image">
          <div class="item-details">
            <h4><%= cartItem.name %></h4>
            <p>$<%= cartItem.price %></p>
          </div>
          <div class="item-qty-wrapper">
            <button class="qty-btn minus" onclick="updateQty('<%= cartItem.id %>', -1)">−</button>
            <div class="item-qty"><%= cartItem.qty %></div>
            <button class="qty-btn plus" onclick="updateQty('<%= cartItem.id %>', 1)">+</button>
          </div>
          <div class="item-qty"><%= cartItem.qty %></div>
          <div class="item-subtotal">$<%= cartItem.subtotal %></div>
          <a href="remove-cart-item/<%= cartItem.id %>" class="remove-btn">×</a>
        </div>
      <% }) %>
  </div>

  <div class="cart-summary">
    <h3>Cart Summary</h3>
    <div class="summary-row">
      <span>Subtotal:</span>
      <span>$<%= cartSubtotal %></span>
    </div>
    <div class="summary-row total">
      <span>Total:</span>
      <span>$<%= cartSubtotal %></span>
    </div>
    <button class="checkout-btn">Proceed to Checkout</button>
  </div>
</div>

</body>
</html>

<script>
  function updateQty(itemId, change) {
    fetch(`/update-qty`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ id: itemId, change: change })
    })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        location.reload(); // or update DOM without reload
      } else {
        alert('Failed to update quantity');
      }
    });
  }
</script>
